%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                      %
%     File: Thesis_Introduction.tex                                    %
%     Tex Master: Thesis.tex                                           %
%                                                                      %
%     Author: Andre C. Marta                                           %
%     Last modified :  2 Jul 2015                                      %
%                                                                      %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Introduction}
\label{chapter:introduction}

In recent years there has been a sharp increase in the number of \gls{iot}
devices and this trend is expected to continue\cite{IoTnumb83:online}. The IoT is a network
of interconnected devices, which exchange data with one another over
the internet. In fact, it can be any object that has an assigned
IP address and is provided with the ability to transfer data over a network. 
While there are many types of IoT devices, all of them
are restricted: they have limited memory, processing power and
available energy. Examples of IoT devices include temperature sensors,
smart light bulbs and physical activity trackers.
Even a salt shaker\cite{SMALTThe76:online} can now be part of the global network.

The \gls{iot} technology provides many benefits, from personal comfort to
transforming entire industries, mainly due to increased connectivity and
new sources for data analysis. The technological development, however, tends to focus on
innovative design rather than on security. \gls{iot} devices frequently
connect to networks using inadequate security and are hard to update when
vulnerabilities are found.

This lack of security in the \gls{iot} ecosystem has been exploited by the
the \textit{Mirai} botnet\cite{sec17ant94:online} when it overwhelmed several high-profile
targets with massive \gls{ddos} attacks. This is the most devastating attack involving \gls{iot}
devices done to date. However, the \textit{Reaper} botnet\cite{ReaperCa10:online} could be
even worse if it is ever put to malicious use. Similar attacks will inadvertently
come in the future.

In the process of the work on this dissertation, we have made several
contributions to the \gls{tls} $1.3$ specification, and were formally recognized as 
contributors\cite{Mergepul65:online}. Our name can be found in the document specifying \gls{tls} $1.3$\cite{RFC8446}.
Although to the lesser extent, we have also contributed to \gls{dtls} $1.3$ specification\cite{DTLS13:online}.
We have found a security vulnerability and a nonconformity to the standard in the
\gls{tls} implementation of the \textit{mbedTLS} library. We reported it and it
has been assigned a \gls{cve} with the id \textit{CVE-2018-1000520}\cite{NVDCVE2094:online}.
It is a vulnerability in the authentication part of the \gls{tls} protocol, where certificates signed with an incorrect algorithm
were accepted in some cases. More specifically, \textit{ECDH(E)-RSA} ciphersuites allowed \gls{ecdsa}-signed
certificates, when only \gls{rsa}-signed ones should have been. We also found a bug in \textit{mbedTLS}'s test suite
related to the use of deprecated \textit{SHA-1}-signed certificates and submitted a code fix to 
it\cite{sslserve89:onelin}\cite{updatete23:online}. We have also developed an extensive set of tooling which
can be used to further study the costs of \gls{tls}, by allowing to automate metric collection and analysis on
different hardware and environments.

\section{Motivation}
%

While inter-device communication has numerous benefits, it is important
to ensure the security of that communication. For example, when you log
in to your online banking account, you do not want others to be
able to see your password, as this may lead to the compromise of your
account. Having your account compromised means that a malicious entity
might take a hold of your money. Similarly, when you are transferring funds via
online banking, you want the contents of that operation to be
invisible to an observer, for privacy reasons. It is also desirable
that no party is able to tamper with the data en transit,
as it may lead to undesired consequences, such as the transfer of a
larger amount than intended. Proper communication security allows
those goals to be achieved.

\gls{tls} is one of the most used protocols for communication security. It
powers numerous technologies, such as \gls{https}. TLS offers the
security services of authentication, confidentiality, privacy, integrity, replay
protection and perfect forward secrecy. It is not a requirement to use all of
those services for every TLS connection. The protocol is similar to
a framework, in the sense that you can enable individual security
services on a per-connection basis. For example, when you are downloading
software updates, while data confidentiality is probably not a concern,
data authenticity and integrity, are. In \gls{tls}, it is possible for a connection
to only offer authenticity and integrity, without offering confidentiality.
Foregoing unnecessary services will lead to a smaller resource usage,
which in turn leads to smaller execution time and power usage. This
is especially important in the context of IoT, due to the constrained
nature of the devices. 

Existing work does not explore the computational costs
of the security services available in \gls{tls}. Examples of such costs are the 
number of CPU cycles executed, time taken and power used.  
Thus, developers wishing to deploy the \gls{tls} protocol
in constrained environments do not have a resource that would help them in choosing a \gls{tls}
configuration appropriate to the environment's needs and limitations.

\gls{tls} is designed to run on top of a reliable, connection-oriented
protocol, such as TCP. \gls{dtls} is the version of \gls{tls} that runs on top
of an unreliable transport protocol, such as UDP. Most \gls{iot} devices have
very limited processing power, storage and energy. Moreover, the performance of
TCP is known to be inefficient in wireless networks, due to its congestion control
algorithm. This situation is worsened with the use of low-power radios and lossy
links found in sensor networks. Therefore, in many cases the use of TCP with \gls{iot}
is not the best option. For this reason, \gls{dtls}, which runs on top
of UDP, is used more frequently in such devices. 
While the work of this dissertation will be focused on \gls{tls}, the majority of it
can also be applied to \gls{dtls}. This is a consequence of \gls{dtls} being 
just an adaption of \gls{tls} over unreliable  transport protocols, 
without changes to the core protocol.

There are numerous IoT devices, each one with different hardware
capabilities and security requirements. For example, some IoT
devices have the resources to use public key cryptography,
while for others symmetric cryptography is the only option.
In some cases, the communicating devices require data authenticity, confidentiality
and integrity (e.g. when logging in into a device), while in others data
authenticity and integrity is enough (e.g. when transferring updates).

\gls{tls} was not designed for the constrained environment of IoT. Despite that,
it is a malleable protocol and can be configured to one's needs. In essence,
it is a combination of various security algorithms that together form
a protocol for communication security. If configured
properly, it is possible to use it in the context of IoT.

The majority of existing work on \gls{tlsd} optimization proposes 
a solution that is either tied to a
specific protocol, such as \gls{coap}, or requires an introduction of a third-party
entity, such as the trust anchor in the case of the S3K system\cite{S3KScala62:online} or
even both. This has two main issues. First, a protocol-specific solution cannot
be easily used in an environment where (D)\gls{tls} is not used with that protocol.
Second, the requirement of a third-party
introduces additional cost and complexity, which will be a big resistance factor
in adopting the technology. This is especially true for developers working on
personal projects or projects for small businesses, leaving the communications insecure
in the worse case scenario. Therefore a solution that is protocol independent and fully 
compatible with the \gls{tlsd} standard and existing infrastructure is desired.

Another area that the existing literature fails to address is that it almost exclusively focuses on \gls{dtls} optimization
and not all of it can be applied to \gls{tls}. Herein we want to further explore \gls{tls} optimization. 
There is clearly a need for that,
especially with \gls{coap} over TCP and \gls{tls} standard\cite{I-D.ietf-core-coap-tcp-tls} being currently developed. The
aforementioned standard does not explore any \gls{tls} optimizations, and since any
\gls{iot} device using it in the future would benefit from them, this is an important
area to explore.

\section{Objectives}

(D)\gls{tls} is a complex protocol with numerous possible configurations. Each configuration
provides different set security services and a different security level. This has a direct
impact on the resource usage. Thus, the cost of a \gls{tlsd} connection can be lowered,
by using an appropriate configuration. Typically, this involves making security/cost trade-offs.
Optimizing the connection cost by selecting one of the numerous configurations available in \gls{tlsd}
 meets our goals of being protocol independent, fully compatible with
existing infrastructure and targeting \gls{tls} optimization specifically.

The objective of this work is to provide a means of assisting application developers
who wish to include secure communications in their applications to make
security/resource usage trade-offs, according to the environment's needs
and limitations. We aim to provide a general overview of of the costs of the \gls{tls} protocol as a whole and
of its individual parts. This is will allow to answer questions such as \textit{How much will we save if we use protocol X instead of Y for authentication?}.
Thus, performing evaluations on specific \gls{iot} hardware or analyzing \gls{tls}-specific optimizations
on it is outside of the scope of this paper.

In order to achieve our goals, the cost of each individual security service
will be evaluated. With this information, the programer will be able to choose a configuration that
meets his security requirements and device constraints. If the limitations of the device's hardware
do not allow to meet the requirements, the programer may decide on an alternative configuration, possibly with
a loss of some security services and a lower security level, or forgo using (D)\gls{tls} altogether.
Thus, this work is targeted towards developers and InfoSec professionals who wish to add communication security
to applications in the IoT environment.

\section{Contributions}

In our work, we performed a thorough cost evaluation of the \gls{tls} $1.2$ implementation in \textit{mbedTLS 2.7.0}.
\textit{mbedTLS} is among the most popular \gls{tls} implementation libraries for embedded systems. We evaluated costs 
in terms of the estimated number of CPU cycles and time taken. The time values were read directly from
the processor's registers. In our analysis we will show that the estimates do reflect real values, by comparing them to time
measurements obtained directly from the CPU registers. We evaluated every single one of the $161$ \gls{tls} configurations available 
in \textit{mbedTLS 2.7.0}, at $4$ different security levels. Each security level differs one from another by the size of the asymmetric keys
that were used.

A \gls{tls} connection consists of two main parts: first, the peers establish a secure communication channel in the Handshake phase,
followed by the data exchange using that channel in the Record phase. We focused on the Handshake part of the protocol for two main reasons.
First, it is the part with the most variability in terms of cost, due to the complex combinations of different possible algorithms.
Second, it is part which has been the least studied by existing work. The Record phase mainly consists in the use symmetric encryption algorithms and hash functions. Their costs has already been thoroughly studied by existing work.

Although our focus was on the Handshake, we also profiled the costs of the symmetric encryption algorithms and hash functions. While the cost of the
Handshake might dominate when small amounts of data are transmitted, the natural question that arises is at how much transferred data the cost of
the Handshake becomes negligible? Our conclusions were that when the devices are expected to transfer a large amount of data 
(a few megabytes, for a typical configuration used on the internet), the focus should not be on
optimizing the Handshake, but rather the algorithms used to to provide data confidentiality and integrity.

We performed evaluations at the high, the middle and the low levels. At the high level, we analyzed and compared the cost of the Handshake for each 
one of the \gls{tls} configurations as a whole. This allowed us to identify groups of configurations with similar costs. Those costs were different for the client and the server. For this reason,
the answer to the question of which configuration is the least costly one for a given set of security service requirements is not straightforward. 
It depends not only on whether our goal is to minimize the cost for the client, the server or both, but also on the security level in use.

At the middle level, we analyzed the cost of each one of the security services offered by \gls{tls}: confidentiality, integrity, \gls{pfs}
and authentication. We explored how a different choice of algorithms for a security service affected its costs. Here, once again, the choice
of the least costly algorithm depends not only on whether the goal is to optimize the client, the server or the cumulative cost, but also on the
security level used.

Finally, at the low level, we analyzed and compared the costs of each one of the individual algorithms used to provide the security services. This allowed us
to further understand the differences in costs observed at the high and middle levels.
For the authentication security service, we profiled the costs of \gls{rsa} and \gls{ecdsa}. Our analysis showed that \gls{rsa} is faster at public key operations
and \gls{ecdsa} at private key operations. Moreover, with the increase of the security level, the costs of \gls{rsa} increase exponentially, while the
costs of \gls{ecdsa} logarithmically. For the \gls{pfs} security service, we profiled the costs of \gls{dh} and \gls{ecdh}. As the security level increased,
the costs of \gls{dh} rose exponentially and the costs of \gls{ecdh} logarithmically. In that sense, gls{dh} is similar
to \gls{rsa} and \gls{ecdh} to \gls{ecdsa}. This is a result of them sharing the same underlying mathematical operations: modular exponentiation for the first group and
multiplication of a scalar by a point on the elliptic curve in the second group.
Finally, for the confidentiality and integrity security services, we profiled each one of the $26$ combinations of a symmetric encryption algorithm and hash function available in \textit{mbedTLS 2.7.0}.

The work on
the dissertation started before \gls{tls} protocol's version $1.3$ specification was finished and there were no embedded device
libraries which implemented it.  For this reason we did not evaluate \gls{tls} $1.3$. Despite that, the results
obtained in this work apply to it as well, since the core functionality of the security services remained mostly unchanged.
In the same manner, the information presented here is also relevant for \gls{dtls} versions $1.2$ and the upcoming version $1.3$.

\section{Results}

In summary, the results of this work are enumerated as follows:

\begin{enumerate}
  \item Evaluation of the costs of the security services of confidentiality, integrity, \gls{pfs} and authentication in \gls{tls}. This evaluation 
  is done in terms of execution time and estimated number of CPU cycles
  \item Evaluation and comparison of the costs of various alternative algorithms which can be used to provide each one of the security services
  \item Evaluation and comparison the costs of all of the possible \gls{tls} configurations present in \textit{mbedTLS 2.7.0}
  \item Contributions to the \gls{tls} protocol's version $1.3$ specification, for which we were formally recognized, by having our name added to the document specifying \gls{tls} $1.3$\cite{RFC8446}
  \item Contributions to the \gls{dtls} protocol's version $1.3$ specification\cite{DTLS13:online}
  \item Finding and reporting a security vulnerability in the peer authentication phase of the protocol and a deviation from the \gls{tls} specification in \textit{mbedTLS 2.7.0}, which was assigned a \gls{cve} with id \textit{CVE-2018-1000520}\cite{NVDCVE2094:online}
  \item Finding and reporting a bug present in \textit{mbedTLS 2.7.0}, as well as submitting a patch to fix to it \cite{sslserve89:onelin}\cite{updatete23:online}
\end{enumerate}

\section{Structure of The Document}

This document is organized as follows. Chapter $2$ describes the most relevant cryptographic concepts and algorithms
that will be used throughout this work, provides and overview of the \gls{tls} and \gls{dtls} protocols 
and presents a summary of the related work. Chapter $3$ focuses on the analysis of the results obtained experimentally,
as well as explains how they were obtained. Finally, Chapter $4$ concludes this document by summarizing the main achievements
and future work.